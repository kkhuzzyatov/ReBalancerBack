<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f4f4f9;
        color: #333;
      }
      .block {
        padding: 20px;
        margin: 10px auto;
        max-width: 800px;
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }
      h2 {
        color: #007bff;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: bold;
      }
      input {
        width: 100%;
        padding: 10px;
        margin-bottom: 15px;
        border: 1px solid #ddd;
        border-radius: 4px;
      }
      button {
        padding: 10px 20px;
        margin: 5px 0;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .hidden {
        display: none;
      }
      .instructions {
        margin-top: 10px;
        padding: 10px;
        background-color: #f9f9f9;
        border-left: 4px solid #007bff;
      }
      .asset-row {
        display: flex;
        gap: 10px;
        margin-bottom: 10px;
      }
      .asset-row input {
        flex: 1;
      }
      .error-message {
        color: #dc3545;
        font-weight: bold;
        margin-top: 10px;
      }
      .success-message {
        color: #28a745;
        font-weight: bold;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <!-- –ë–ª–æ–∫ 0 -->
    <div class="block">
      <p>
        –ü—Ä–∏–≤–µ—Ç! üñêÔ∏è –Ø ‚Äî –≤–∞—à –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏. –° –º–æ–µ–π –ø–æ–º–æ—â—å—é –≤—ã —Å–º–æ–∂–µ—Ç–µ
        —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –ª–æ—Ç–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–∏–∫–µ—Ä–æ–≤ –Ω—É–∂–Ω–æ –∫—É–ø–∏—Ç—å –∏–ª–∏ –ø—Ä–æ–¥–∞—Ç—å
        –Ω–∞ –¢-–ò–Ω–≤–µ—Å—Ç–∏—Ü–∏—è—Ö –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–≤—ã—Ö –ø—Ä–æ–ø–æ—Ä—Ü–∏–π –≤–∞—à–µ–≥–æ –ø–æ—Ä—Ç—Ñ–µ–ª—è.
      </p>
      <button onclick="toggleInstructions('newUser')">
        –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      </button>
      <button onclick="toggleInstructions('registeredUser')">
        –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
      </button>
      <div id="newUserInstructions" class="instructions hidden">
        <p>1. –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é –ø–æ—á—Ç—É –≤ –ø–æ–ª–µ "–í–≤–µ–¥–∏—Ç–µ –ø–æ—á—Ç—É".</p>
        <p>2. –ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å –∏ –≤–≤–µ–¥–∏—Ç–µ –µ–≥–æ –≤ –ø–æ–ª–µ "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å".</p>
        <p>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã —É—Å–ø–µ—à–Ω–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–ª–∏—Å—å.</p>
      </div>
      <div id="registeredUserInstructions" class="instructions hidden">
        <p>1. –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ—é –ø–æ—á—Ç—É –≤ –ø–æ–ª–µ "–í–≤–µ–¥–∏—Ç–µ –ø–æ—á—Ç—É".</p>
        <p>2. –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π –ø–∞—Ä–æ–ª—å –≤ –ø–æ–ª–µ "–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å".</p>
        <p>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—ã –≤–æ—à–ª–∏ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç.</p>
        <p>
          –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –Ω–∞–∂–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ". –í—Å–µ —Ä–∞–Ω–µ–µ
          —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–≥—Ä—É–∑—è—Ç—Å—è –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è.
        </p>
      </div>
    </div>

    <!-- –ë–ª–æ–∫ 1 -->
    <div class="block">
      <label for="email">–í–≤–µ–¥–∏—Ç–µ –ø–æ—á—Ç—É:</label>
      <input type="email" id="email" placeholder="example@example.com" />
    </div>

    <!-- –ë–ª–æ–∫ 2 -->
    <div class="block">
      <label for="password">–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å:</label>
      <input type="password" id="password" placeholder="–ü–∞—Ä–æ–ª—å" />
    </div>

    <!-- –ë–ª–æ–∫ 3 -->
    <div class="block">
      <button onclick="saveData()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
      <button id="loadDataButton" onclick="loadData()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ</button>
      <button onclick="calculateRebalance()">–ü–æ—Å—á–∏—Ç–∞—Ç—å —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É</button>
    </div>

    <!-- –ë–ª–æ–∫ 4 -->
    <div class="block">
      <h2>–¢–µ–∫—É—â–∞—è –∞–ª–ª–æ–∫–∞—Ü–∏—è</h2>
      <button onclick="addAsset('currentAllocation')">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</button>
      <div id="currentAllocation"></div>
    </div>

    <!-- –ë–ª–æ–∫ 5 -->
    <div class="block">
      <h2>–¶–µ–ª–µ–≤—ã–µ –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ –∞–ª–ª–æ–∫–∞—Ü–∏–∏</h2>
      <button onclick="addAsset('targetAllocation')">–î–æ–±–∞–≤–∏—Ç—å –∞–∫—Ç–∏–≤</button>
      <div id="targetAllocation"></div>
    </div>

    <!-- –ë–ª–æ–∫ 6 -->
    <div class="block">
      <label for="topUpAmount"
        >–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É –¥–ª—è –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±—Ä–æ–∫–µ—Ä—Å–∫–æ–≥–æ —Å—á–µ—Ç–∞ (–≤–≤–µ–¥–∏—Ç–µ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—É—é
        —Å—É–º–º—É, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –≤—ã–≤–µ—Å—Ç–∏ —Å—Ä–µ–¥—Å—Ç–≤–∞):</label
      >
      <input type="number" id="topUpAmount" placeholder="–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è" />
      <button onclick="saveTopUpAmount()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>

    <script>
      function toggleInstructions(type) {
        const newUserDiv = document.getElementById("newUserInstructions");
        const registeredUserDiv = document.getElementById(
          "registeredUserInstructions"
        );
        if (type === "newUser") {
          newUserDiv.classList.toggle("hidden");
          registeredUserDiv.classList.add("hidden");
        } else if (type === "registeredUser") {
          registeredUserDiv.classList.toggle("hidden");
          newUserDiv.classList.add("hidden");
        }
      }

      function addAsset(blockId) {
        const block = document.getElementById(blockId);
        const newAsset = document.createElement("div");
        newAsset.className = "asset-row";
        newAsset.innerHTML = `
                <label>–¢–∏–∫–µ—Ä: <input type="text" placeholder="–¢–∏–∫–µ—Ä"></label>
                <label>${
                  blockId === "currentAllocation"
                    ? "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç—É–∫):"
                    : "–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞:"
                } 
                    <input type="number" placeholder="${
                      blockId === "currentAllocation" ? "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ" : "–ü—Ä–æ—Ü–µ–Ω—Ç"
                    }">
                </label>
            `;
        block.appendChild(newAsset);
      }

      async function saveData() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;
        const curAlloc = parseAllocation("currentAllocation");
        const targetAlloc = parseAllocation("targetAllocation");
        const topUpAmount = document.getElementById("topUpAmount").value;

        const data = {
          email,
          password,
          curAlloc,
          targetAlloc,
          topUpAmount: parseFloat(topUpAmount),
        };

        try {
          const response = await fetch("http://localhost:8080/save", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });
          if (!response.ok) {
            throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö");
          }
          showMessage("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã", "success");
        } catch (error) {
          showMessage(error.message, "error");
        }
      }

      async function loadData() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        if (!email || !password) {
          alert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è –ø–æ—á—Ç–∞ –∏ –ø–∞—Ä–æ–ª—å");
          return;
        }

        const data = {
          email,
          password,
        };

        try {
          const response = await fetch("http://localhost:8080/getdata", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });
          if (!response.ok) {
            throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö");
          }
          const result = await response.json();
          fillForm(result);
          showMessage("–î–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω—ã", "success");
        } catch (error) {
          showMessage(error.message, "error");
        }
      }

      async function calculateRebalance() {
        const email = document.getElementById("email").value;
        const password = document.getElementById("password").value;

        const data = {
          email,
          password,
        };

        try {
          const response = await fetch("http://localhost:8080/calc", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(data),
          });
          if (!response.ok) {
            throw new Error("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á–µ—Ç–µ —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏");
          }
          const result = await response.json();
          showMessage(`–†–µ–∑—É–ª—å—Ç–∞—Ç —Ä–µ–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∏: ${result}`, "success");
        } catch (error) {
          showMessage(error.message, "error");
        }
      }

      function parseAllocation(blockId) {
        const block = document.getElementById(blockId);
        const inputs = block.querySelectorAll("input");
        const allocation = {};
        for (let i = 0; i < inputs.length; i += 2) {
          const ticker = inputs[i].value;
          const value = inputs[i + 1].value;
          if (ticker && value) {
            allocation[ticker] = parseFloat(value);
          }
        }
        return allocation;
      }

      function fillForm(data) {
        document.getElementById("email").value = data.email || "";
        document.getElementById("password").value = data.password || "";
        document.getElementById("topUpAmount").value = data.topUpAmount || "";
        fillAllocation("currentAllocation", data.curAlloc);
        fillAllocation("targetAllocation", data.targetAlloc);
      }

      function fillAllocation(blockId, allocation) {
        const block = document.getElementById(blockId);
        block.innerHTML = "";
        for (const [ticker, value] of Object.entries(allocation)) {
          const newAsset = document.createElement("div");
          newAsset.className = "asset-row";
          newAsset.innerHTML = `
                    <label>–¢–∏–∫–µ—Ä: <input type="text" value="${ticker}" readonly></label>
                    <label>${
                      blockId === "currentAllocation"
                        ? "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç—É–∫):"
                        : "–ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –∫–∞–ø–∏—Ç–∞–ª–∞:"
                    } 
                        <input type="number" value="${value}" readonly>
                    </label>
                `;
          block.appendChild(newAsset);
        }
      }

      function showMessage(message, type) {
        const messageDiv = document.createElement("div");
        messageDiv.className =
          type === "error" ? "error-message" : "success-message";
        messageDiv.textContent = message;
        document.body.appendChild(messageDiv);
        setTimeout(() => messageDiv.remove(), 3000);
      }

      function saveTopUpAmount() {
        const topUpAmount = document.getElementById("topUpAmount").value;
        showMessage(`–°—É–º–º–∞ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞: ${topUpAmount}`, "success");
      }
    </script>
  </body>
</html>
